---
layout: info
title: Safety Incidents
permalink: /safety_incidents/
---

<html>
<head>
</head>
<body>
  <div id="safety_database_admin"></div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    google.charts.load('current', {'packages' : ['table']});

    google.charts.setOnLoadCallback(function() { initialize() });

    function initialize() {
      document.getElementById('safety_database_admin').innerHTML = "<i class='fa fa-spinner fa-spin fa-3x fa-fw'></i>";
      
      var dataSourceUrl = 'https://docs.google.com/spreadsheets/d/1506GzZ7-BxCvmbYpE85zpmsveFfYcOo5jK5oDsje7B8/gviz/tq';

      // Tells it that the first row contains headers: 'Role', 'Reports To', 'Name'
      var query = new google.visualization.Query(dataSourceUrl);

      // Send the query with a callback function.
      query.send(handleQueryResponse);
    }

    function handleQueryResponse(response) {
      // Called when the query response is returned.
      if (response.isError()) {
        alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
        return;
      } else {
        alert('Query successful!')
      }

      var raw_data = response.getDataTable();
      var data = new google.visualization.DataTable();

      data.addColumn('string', 'Name');
      data.addColumn('string', 'Email');
      data.addColumn('string', 'Phone');
      data.addColumn('string', 'Project');
      data.addColumn('string', 'Date');
      data.addColumn('string', 'Time');
      data.addColumn('string', 'Room');
      data.addColumn('string', 'Description');
      data.addColumn('string', 'Injuries Sustained');
      data.addColumn('string', 'Emergency Response Actions');
      data.addColumn('string', 'Reported to UBC CAIRS?')
      data.addColumn('string', 'Actions Recommended')

      // Loops through all rows and populates a new DataTable with formatted values for the orgchart
      var num_rows = raw_data.getNumberOfRows();

      for (var i = 1; i < num_rows; i++) {
        data.addRows(1)
        var name = raw_data.getValue(i, 0);
        data.setCell(i, 0, name);
        
        var email = raw_data.getValue(i,1);
        data.setCell(i, 1, email);

        var phone = raw_data.getValue(i, 2);
        data.setCell(i, 2, phone);

        var project = raw_data.getValue(i, 3);
        data.setCell(i, 3, project);

        var date = raw_data.getValue(i, 4);
        data.setCell(i, 4, date);

        var time = raw_data.getValue(i, 5);
        data.setCell(i, 5, time);
        
        var room = raw_data.getValue(i, 6);
        data.setCell(i, 6, room);
        
        var description = raw_data.getValue(i, 7);
        data.setCell(i, 7, description);

        var injuries = raw_data.getValue(i, 8);
        data.setCell(i, 8, injuries);

        var emergency = raw_data.getValue(i, 9);
        data.setCell(i, 9, emergency);

        var reported = raw_data.getValue(i, 10);
        data.setCell(i, 10, reported);

        var actions = raw_data.getValue(i, 11);
        data.setCell(i, 11, actions);
      }

      // Loops through all rows and populates a new DataTable with formatted values for the orgchart
      var container = document.getElementById('safety_database_admin');
      var table = new google.visualization.Table(container);
      table.draw(data, {showRowNumber: true, width: '100%', height: '100%'});
    }      
  </script>
</body>
</html>